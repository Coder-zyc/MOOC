<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>星级评分--点击后不能在选了</title>
    <style>
        body,
        ul,
        li {
            padding: 0;
            margin: 0;
        }

        li {
            list-style-type: none;
        }

        .rating {
            width: 150px;
            height: 38px;
            margin: 100px auto;
        }

        .rating-item {
            float: left;
            width: 30px;
            height: 38px;
            background: url(./image/star.png) no-repeat;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <ul class="rating" id="rating">
        <li class="rating-item" title="很好不好"></li>
        <li class="rating-item" title="不好"></li>
        <li class="rating-item" title="一般"></li>
        <li class="rating-item" title="好"></li>
        <li class="rating-item" title="很好"></li>
    </ul>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script>
        // 1 初始化函数 init
        // 2 默认参数 defaults ：对象
        // 3.点亮整课星星的函数 LightEntire

        //匿名自调用函数,立即执行
        var rating = (function () {

            //继承
            var extend = function (subClass, superClass) {
                var F = function () {};
                F.prototype = superClass.prototype;
                subClass.prototype = new F();
                subClass.prototype.construtor = subClass;
            };

            //默认参数
            var defaults = {
                num: 0,
                mode: "LightHalf",
                readOnly: false,
                select: function () {},
                chosen: function () {}
            };

            //初始化函数 init
            var init = function (el, option) {
                var $el = $(el),
                    rating = $el.data("rating"),
                    options = $.extend({}, defaults, typeof option === "object" && option);
                if (!mode[options.mode]) {
                    options.mode = "LightHalf";
                }
                // new LightEntire(el, options).init();
                if (!rating) {
                    $el.data("rating", (rating = new mode[options.mode](el, options)))
                    rating.init();
                }
                if (typeof option === "string"){
                    rating[option]();
                }
                // new LightHalf(el, options).init();
            };


            //父类星星
            var Light = function (el, options) {
                this.el = $(el);
                this.items = this.el.find(".rating-item");
                this.opts = options,
                    this.add = 1,
                    this.selectEvent = "mouseover";

            };
            Light.prototype.init = function () {
                this.lightOn(this.opts.num);
                if (this.opts.readOnly === false) {
                    this.bindEvent();
                }

            };
            Light.prototype.lightOn = function (num) {
                num = parseInt(num);
                this.items.each(function (index) {
                    if (index < num) {
                        $(this).css("background-position", "0 -38px");
                    } else {
                        $(this).css("background-position", "1px 2px");
                    }
                });
            };
            Light.prototype.bindEvent = function () {
                var self = this,
                    itemLength = this.items.length;
                self.el.on(self.selectEvent, ".rating-item", function (e) {
                    var num = 0,
                        $this = $(this);

                    self.select(e, $this);
                    num = $(this).index() + self.add;
                    self.lightOn(num);

                    (typeof self.opts.select === "function") && self.opts.select.call(this, num,
                        itemLength);
                    self.el.trigger("select", [num, itemLength]);
                }).on("click", ".rating-item", function () {
                    self.opts.num = $(this).index() + self.add;

                    (typeof self.opts.chosen === "function") && self.opts.chosen.call(this, self.opts
                        .num, itemLength);
                    self.el.trigger("chosen", [self.opts.num, itemLength]);
                }).on("mouseout", function () {
                    self.lightOn(self.opts.num);
                })
            };
            Light.prototype.select = function () {
                throw new Error("子类必须重写此方法");
            };
            Light.prototype.unbindEvent = function () {
                this.el.off()
            };
                
            //点亮整颗星星的函数 LightEntire
            var LightEntire = function (el, options) {
                Light.call(this, el, options) //把自己的父类传递给父类,调用父类的构造函数,继承
                this.selectEvent = "mouseover";

            };
            extend(LightEntire, Light);
            LightEntire.prototype.lightOn = function (num) {
                Light.prototype.lightOn.call(this, num);
            };
            LightEntire.prototype.select = function () {
                self.add = 1;
            };
            
            //点亮半颗星星的函数 LightEntire
            var LightHalf = function (el, options) {
                Light.call(this, el, options);
                this.selectEvent = "mousemove";

            };
            extend(LightHalf, Light);
            LightHalf.prototype.lightOn = function (num) {
                var count = parseInt(num),
                    isHalf;
                if (count != num) {
                    isHalf = true;
                } else {
                    isHalf = false;
                }
                Light.prototype.lightOn.call(this, count);
                if (isHalf) {
                    this.items.eq(count).css("background-position", "1px -78px");
                }

            };
            LightHalf.prototype.select = function (e, $this) {
                if (e.pageX - $this.offset().left < $this.width() / 2) {
                    this.add = 0.5;
                } else {
                    this.add = 1;
                }
            };
     
            //jQuery插件
            $.fn.extend({
                rating:function(option){
                    return this.each(function(){
                        init(this,option);
                    });
                }
            });
          
            //mode 要放在 LightEnture和LightHalf下面
            var mode = {
                "LightEntire": LightEntire,
                "LightHalf": LightHalf
            };

            return {
                init: init
            };

        })();

        $("#rating").rating({
            mode:"LightHalf",
            num:2.5
        });
        $("#rating").on("chosen", function(){
            $("#rating").rating("unbindEvent");
        })

        // rating.init("#rating", {
        //     num: 2.5,
        //     mode: "LightHalf",
        //     chosen: function () {
        //         rating.init("#rating", "unbindEvent");
        //     }

        // });

        // $("#rating").on("select", function (e, num, total) {
        //     console.log(num + "/" + total);
        // }).on("chosen", function (e, num, total) {
        //     console.log(num + "/" + total);
        // })
    </script>
</body>

</html>